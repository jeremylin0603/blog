# æ€Žæ¨£ç®—ä¸€å€‹å­—

## å­—å…ƒç¸½è¡¨ - Unicode

1. ä¸–ç•Œä¸Šå¹¾ä¹Žå¤§éƒ¨åˆ†çš„å­—å…ƒï¼ŒåŒ…å« emojiï¼Œéƒ½è¢«æ¶µè“‹åœ¨ Unicode ç·¨ç¢¼åº•ä¸‹ï¼Œä¹Ÿå°±æ˜¯åœ¨ Unicode é€™å¼µè¡¨ä¸­ï¼Œæ¯å€‹å­—éƒ½æœ‰ä¸€å€‹ç¨ç«‹çš„ id(çµ„åˆå­—ä¾‹å¤–ï¼Œå¾ŒçºŒè£œå……)

2. Unicode ç”¨ 17 çµ„ä¾åºçš„`å¹³é¢(Plant)`ä¾†å¤§è‡´å€åˆ†ä¸åŒæ„åœ–çš„æ–‡å­—ï¼Œå¾ž 0 è™Ÿå¹³é¢é–‹å§‹ï¼Œç›´åˆ° 16 è™Ÿå¹³é¢ã€‚ä¾‹å¦‚ç¬¬ 0 å¹³é¢ç‚ºåŸºæœ¬æ–‡å­—ï¼ˆä¸­è‹±æ—¥éŸ“æ•¸å­—...ï¼‰ã€ç¬¬ 1 å¹³é¢ç‚ºå¹¾ä¹Žå¤±å‚³çš„å¤æ–‡å’Œæ•¸å­¸ç¬¦è™Ÿã€éŸ³ç¬¦ã€emojiï¼Œè«¸å¦‚æ­¤é¡žæ¯å€‹å¹³é¢çš„ç·¨ç¢¼éƒ½æ¶µè“‹äº†ä¸åŒæ„æ€çš„æ–‡å­—

3. èˆ‰ä¾‹ï¼Œ0 è™Ÿå¹³é¢çš„ç¯„åœç‚º 0000 ~ FFFFï¼Œ1 è™Ÿå¹³é¢çš„ç¯„åœç‚º 10000 ~ 1FFFFã€‚  
   å…¶ä¸­å¹³é¢ 0ï¼Œè‹±æ–‡å­—æ¯ A çš„ä»£è™Ÿç‚º `U+0041`ï¼Œä¸­æ–‡æ•¸å­— ä¸€ çš„ä»£è™Ÿç‚º `U+4E00`  
   å¹³é¢ 1ï¼Œ'ðŸ˜€' çš„ä»£è™Ÿç‚º `U+1F600`

[wiki - Unicode å­—å…ƒå¹³é¢å°æ˜ ](https://zh.wikipedia.org/wiki/Unicode%E5%AD%97%E7%AC%A6%E5%B9%B3%E9%9D%A2%E6%98%A0%E5%B0%84)

## å¾žä»£è™Ÿåˆ°è¨ˆç®—æ©Ÿ

1. æ¯å€‹å­—å…ƒåœ¨ Unicode ä¸­éƒ½æœ‰ç‰¹æ®Šçš„ä»£è™Ÿï¼Œä¾‹å¦‚è‹±æ–‡ 'a' Unicode ç·¨ç¢¼ç‚º `U+0061`ï¼Œä½† Unicode åªè² è²¬å®šç¾©æ¯å€‹æ–‡å­—çš„ç·¨è™Ÿï¼Œä¸¦ä¸è² è²¬é€™äº›æ–‡å­—åœ¨è¨ˆç®—æ©Ÿä¸­å¦‚ä½•å­˜å„²æˆ–æ˜¯å¦‚ä½•å‚³è¼¸ï¼Œå› æ­¤ç‚ºäº†æœå‹™è¨ˆç®—æ©Ÿå‚³è¼¸å’Œå„²å­˜ï¼Œè¡ä¼¸å‡ºå…©å¤§å¸¸è¦‹çš„ç·¨ç¢¼æ ¼å¼ UTF-8 & UTF-16ã€‚

## UTF-8 vs UTF-16

1. UTF-8 çš„ç³»çµ±ä¸­ï¼Œä½¿ç”¨ 1 ~ 4 å€‹ byte ä¾†è¡¨é”ä¸€å€‹ char

```js
const utf8_A = new TextEncoder().encode('A')
console.log(utf8_A) // Uint8Array [ 65 ] --> 1 byte (0x41)

const utf8_smile = new TextEncoder().encode('ðŸ˜Š')
console.log(utf8_smile) // Uint8Array [ 240, 159, 152, 138 ] --> 4 bytes (0xF0 0x9F 0x98 0x8A)
```

2. UTF-16 çš„ç³»çµ±ä¸­ï¼Œä½¿ç”¨ 2 or 4 å€‹ byte ä¾†è¡¨é”ä¸€å€‹ charï¼Œå…¶ä¸­ç•¶ 2 byte ç„¡æ³•è¡¨é”æ™‚ï¼Œï¼ˆä¹Ÿå°±æ˜¯è¶…éŽç¬¬ 0 å¹³é¢ã€ŒBMPã€çš„ç¯„åœ`U+0000`~`U+FFFF`ï¼‰ï¼Œæœƒæ”¹ç”¨ 4 byte ä¾†è¡¨é”ï¼Œæ­¤æ™‚é€™ 2 + 2 byte çš„çµ„åˆç¨±ç‚ºä»£ç†å°(surrogate pair)

```js
// "A" çš„ UTF-16 ç·¨ç¢¼
const utf16_A = new Uint16Array([0x0041])
console.log(utf16_A) // Uint16Array [ 65 ] => é›–ç„¶èˆ‡ UTF-8 éƒ½æ˜¯ 65ï¼Œä½†å­˜å„²æ˜¯ç”¨ 2 bytes (0x0041)

// "ðŸ˜Š" çš„ UTF-16 ç·¨ç¢¼
const utf16_smile = new Uint16Array([0xd83d, 0xde0a])
console.log(utf16_smile) // Uint16Array [ 55357, 56842 ] => 4 bytes (0xD83D 0xDE0A)
```

> `0x` é–‹é ­è¡¨é”æ•¸å­—ç‚º 16 é€²ä½ï¼Œå› æ­¤ 0x0041 => 4 \* 16 + 1 = 65

3. çµåˆå‰é¢å…©é»žï¼Œé€šå¸¸ä½¿ç”¨ UTF-8 ç·¨ç¢¼æœƒæ›´çœç©ºé–“ã€‚

## Javascript çš„è¡¨é”èˆ‡å­—å…ƒé•·åº¦

1. åœ¨ JS ä¸­æœƒä½¿ç”¨ `\u` ç•¶å‰ç¶´ä»¥è¡¨é”ä¸€å€‹ Unicode å­—å…ƒ

```js
'ðŸ’©' === '\uD83D\uDCA9' // true
```

2. åœ¨ JS ä¸­æ˜¯ä»¥ UTF-16 ç·¨ç¢¼ä¾†åˆ¤æ–·å­—å…ƒé•·åº¦ï¼Œå› æ­¤ç•¶å­—å…ƒæ˜¯ä¸€å€‹ä»£ç†å°(surrogate pair)æ™‚ï¼Œé•·åº¦ç‚º 2

```js
'ðŸ’©'.length // 2
```

> å°æ–¼ä»£ç†å°ï¼Œå¯ä»¥ä½¿ç”¨ `Array.from` ä¾†åˆ‡åˆ†å…¶å­—ä¸²é•·åº¦

```js
'ðŸ’©'.split('').length // 2 -> å¯¦éš›ç‚º ['\uD83D', '\uDCA9'].length
Array.from('ðŸ’©').length // 1 -> æ­¤æ™‚ä¸€å€‹ä»£ç†å°ç‚ºä¸€å€‹å€¼ ["ðŸ’©"].length
```

3. åœ¨ JS ä¸­å¯ä»¥ä½¿ç”¨ `String.codePointAt()` ä¾†æŸ¥è©¢å­—å…ƒçš„ Unicode ç¢¼ä½

```js
'ðŸ’©'.codePointAt() // 128169
```

## éº»ç…©çš„ã€Œé›¶å¯¬é€£å­—(ZWJ)ã€

1. åœ¨ emoji ç³»çµ±ä¸­ï¼Œé‚„å­˜åœ¨å„ç¨®ä¸åŒçš„ Unicode å­—å…ƒçµ„åˆæˆä¸€å€‹æ–°çš„ç¬¦è™Ÿï¼ŒåŒ…å« emoji å’Œéƒ¨åˆ†åœ‹å®¶çš„èªžè¨€ï¼Œç¨±ç‚º ZWJ(Zero Width Joiner)ã€‚

2. JS åœ¨åˆ¤æ–·ä¸€å€‹ ZWJ ç¬¦è™Ÿæ™‚ï¼Œæ˜¯ä»¥ã€Œæ‰€æœ‰çµ„åˆã€ä¸‹åŽ»åˆ¤åˆ¥çš„ï¼Œæ‰€ä»¥èž¢å¹•ä¸Šçœ‹åˆ°çš„ä¸€å€‹å­—ç¬¦å°æ–¼ JS ä¾†èªªä¸¦ä¸æ˜¯ä¸€å€‹å­—ç¬¦æˆ–æ˜¯ä¸€å€‹ä»£ç†å°ï¼Œè€Œæ˜¯ã€Œä¸€ç¾¤å­—ç¬¦ã€ï¼Œå› æ­¤å°æ–¼ ZWJï¼Œæ²’æœ‰ä¸€å€‹å¸¸è¦çš„åšæ³•åŽ»åˆ¤æ–·é•·åº¦ã€‚

```js
'ðŸ´ó §ó ¢ó ¥ó ®ó §ó ¿'.split('') // ['\uD83C', '\uDFF4', '\uDB40', '\uDC67', '\uDB40', '\uDC62', '\uDB40', '\uDC65', '\uDB40', '\uDC6E', '\uDB40', '\uDC67', '\uDB40', '\uDC7F']

Array.from('ðŸ´ó §ó ¢ó ¥ó ®ó §ó ¿') // ['ðŸ´', 'ó §U+200D', 'ó ¢U+E0065', 'ó ¥U+E006E', 'ó ®U+E0067', 'ó §U+E007F']
```

[Emoji Charts](https://unicode.org/emoji/charts/emoji-zwj-sequences.html)

### å­—å…ƒç¸½è¡¨ - ASCII

1. å¸¸å¸¸æœƒè½åˆ°çš„ ASCII å…¶å¯¦å°±æ˜¯ Unicode çš„å‰èº«ï¼Œåªå–®ç´”å®šç¾©äº†è‹±æ–‡ã€æ•¸å­—ã€åŸºæœ¬æ¨™é»žç¬¦è™Ÿï¼Œå’Œä¸€äº›è·³è„«å­—å…ƒï¼ŒUnicode æ˜¯å‘å¾Œç›¸å®¹ ASCII çš„ã€‚

2. å…©å¤§ç·¨ç¢¼ç³»çµ±ä¹Ÿç›¸å®¹ ASCIIï¼Œä½†æ˜¯ UTF-8 åœ¨è¡¨é”èˆ‡ ASCII ç›¸åŒçš„å­—å…ƒæ™‚ï¼Œä¸€æ¨£æ˜¯ç”¨ä¸€å€‹ byte ä¾†è¡¨é”ï¼Œèˆ‡ ASCII å®Œå…¨ç›¸ç¬¦ï¼Œå› æ­¤ UTF-8 ç›¸è¼ƒ UTF-16 æ›´å®Œæ•´çš„ç›¸å®¹ ASCIIã€‚

[WIKI-ASCII](https://zh.wikipedia.org/zh-tw/ASCII)

### åƒè€ƒè³‡æ–™

[åœ¨ç¨‹å¼è£¡ç®— Emoji å­—æ•¸çš„é‚£äº›å•é¡Œ](https://medium.com/dcardlab/%E5%9C%A8%E7%A8%8B%E5%BC%8F%E8%A3%A1%E7%AE%97-emoji-%E5%AD%97%E6%95%B8%E7%9A%84%E9%82%A3%E4%BA%9B%E5%95%8F%E9%A1%8C-8e1a1170a499)

## Update åŽŸç”Ÿæ”¯æ´çš„ `Intl.Segmenter`

ç¾åœ¨ JS å·²ç¶“èƒ½å¤ åŽŸç”Ÿæ”¯æ´å”åŠ©é–‹ç™¼è€…æ›´å¥½çš„åˆ¤æ–· ZWJ æ ¼å¼çš„å­—å…ƒäº†

```js
/**
 * ç¬¬ä¸€å€‹åƒæ•¸èƒ½å¤ æŒ‡å®šèªžç³»ï¼Œé€™é‚Šæˆ‘å€‘ä¸éœ€è¦æ‰€ä»¥
 * grapheme è¡¨ç¤ºå¸Œæœ›å°‡å­—ä¸²åˆ†å‰²æˆåœ–å½¢(grapheme)ï¼Œåœ–å½¢æ˜¯æŒ‡ä¸€å€‹æˆ–å¤šå€‹å­—å…ƒçµ„æˆçš„æœ€å°å–®ä½ï¼Œåœ¨é€™å€‹ä¾‹å­ä¸­æœƒå°‡ç”± ZWJ å¤šå€‹å­—å…ƒçµ„æˆçš„ emoji ç•¶æˆä¸€å€‹åœ–å½¢è™•ç†ã€‚
 */
const segmenter = new Intl.Segmenter(void 0, { granularity: 'grapheme' })

// input -> 'ðŸ‘©â€ðŸ¦°ðŸ‘©â€ðŸ‘©â€ðŸ‘¦â€ðŸ‘¦ðŸ³ï¸â€ðŸŒˆ'
const input = String.fromCodePoint(
  0x1f469,
  0x200d,
  0x1f9b0,
  0x1f469,
  0x200d,
  0x1f469,
  0x200d,
  0x1f466,
  0x200d,
  0x1f466,
  0x1f3f3,
  0xfe0f,
  0x200d,
  0x1f308
)

const segments = segmenter.segment(input)

const graphemes = Array.from(segments, (s) => s.segment)

console.log(graphemes)
console.log(graphemes.length) // 3
```

[MDN Intl.Segmenter](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/Segmenter)
